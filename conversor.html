<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Conversor Excel para Market</title>
    <style>
        body { font-family: sans-serif; padding: 20px; line-height: 1.6; }
        .caixa { border: 2px dashed #ccc; padding: 20px; text-align: center; cursor: pointer; }
        pre { background: #eee; padding: 15px; overflow-x: auto; border-radius: 5px; }
        button { padding: 10px 20px; background: #2196F3; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <h2>1. Selecione seu arquivo CSV do Excel</h2>
    <input type="file" id="csvFile" accept=".csv" />
    
    <h2>2. Resultado (Arquivo de Backup)</h2>
    <p>O conteúdo abaixo será gerado automaticamente. Clique em baixar para salvar o arquivo que você vai <b>Importar</b> no seu sistema.</p>
    
    <button id="btnDownload" style="display:none;">BAIXAR ARQUIVO DE BACKUP (.JSON)</button>
    <pre id="output">O resultado aparecerá aqui...</pre>

    <script>
        document.getElementById('csvFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const reader = new FileReader();

            reader.onload = function(event) {
                const text = event.target.result;
                const lines = text.split('\n');
                let produtosDB = {};

                lines.forEach(line => {
                    // Divide por vírgula ou ponto-e-vírgula (comum no Excel Brasil)
                    const cols = line.split(/[;,]/);
                    
                    if (cols.length >= 3) {
                        const codigo = cols[0].trim();
                        const nome = cols[1].trim();
                        const preco = parseFloat(cols[2].trim().replace(',', '.'));

                        if (codigo && nome && !isNaN(preco)) {
                            produtosDB[codigo] = { nome: nome, preco: preco };
                        }
                    }
                });

                const jsonResult = JSON.stringify(produtosDB, null, 2);
                document.getElementById('output').textContent = jsonResult;
                
                const btn = document.getElementById('btnDownload');
                btn.style.display = 'block';
                btn.onclick = () => {
                    const blob = new Blob([jsonResult], { type: "application/json" });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement("a");
                    a.href = url;
                    a.download = "produtos_importar.json";
                    a.click();
                };
            };
            reader.readAsText(file);
        });
    </script>
</body>
</html>